init 0 python:
    import store.fae_outfits as fae_outfits


    class Sayori(object):
        """
        MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMMMMMMMMMMMMMMMMMMMMMW0dodk0KXNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMMMMMMMMMMMMMWNXK0Okxo:',,,,;codxk0XWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMMMMMMMMMWN0xdlccc::c;'',,,'',colccldkKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMMMMMMMWKxlcccccclodo;'',,''''';:;;;;,;lxOXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMMMMMMNkllodddolloddxl;,,,,''....''..'''''cKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMMMMWXdloxxxddxkxxxolodddxxxddl;'.'........dNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMMMWXxoxkkkddkOOkkO0kxddxxk0KK0kl,........':oOWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMMWXkx000OkkOOOOO0OOOOOkkk00OkO0ko,......,:::oKMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMNKxox0XX0kO000000OOOO0KK0Okxook0Od:,,,:cclolco0WMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMN0xclk0KKOkKXXKKKX000OO0KKOxddlok0Okkxlldolodc:dOKNWWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMNKKklxOOKOdkKXXKKXXXK0OkOOOOOkdocoO0OOOxldxodxocd0XXNWWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMKKNOdkkOKOxk0KKK0KKXKKOOXK0OOkxdl:d000OkddkddkdlldXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMM0x0xokOO00kO0KKXK00KXX0OXNNXKOOxo;cOK0OOxxkkOOxollOXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMKlllcxOO00OKXKKXXXK0KXKKNWWWWNNX0kdOKK0OOOOOxxddo:oXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMWOo::xkOOOO0NNNXXXNXXKXXNNX0xold0NK0K000Okkkxdddl:dNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMM0kxldkxkkOKNNNNNX00XK0KNN0o,...'oO0000OOkxdollllckWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMOxKxoxxxkkdoloONWNXNWNNNWNkodoodxO0OOkxkxdo:;coolxNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMOdXOcodxd::c;;:kNWWWWWWWWWX0KKKKK0OOkdddol:,,;cd0KNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMNO0k::ldocd0xkO0XWWWWWWWWWNNXXXK00kkkxccll:;:oONMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMNOkl;:lolok000XNNNNNNWNNNNNNXK0Oxxkkdlll::xXNMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMNKkxdc,;;:clx0KXXNNNNNNNNNNNNNXX0OOxdxlcox0WMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMX00kxx:',,,;:lOXXXNX000OOkxOXNXXKOkdldkOKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMM0odxd:,;:coxxdx0XNNKdcodxkk0XNXX0kdlloxKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMNxll:;oO00NWWWNKKKXNX0kOO0KXNXKOdoodxxxdxOKXNXXK00OO0XWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMW0ccd0NMMMMMMMMMWXXXKKXXXXXKOxdooodxxddxOxodxxdddddoodONMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMW0okNMMMMMMMMMNKOxdolcokOkkoloddodxxxOKNNkdxxxxxxddxkxoxXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMNKXWMMMMMMMWOc,''',,,lxxxxlloodxO0KNMMMKdxxxxxxxxxxxxxd0MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMMMMMMMMMMWk:,,,,,,,;oOxddolloxO0NMMMMWOdxxdoddddxxxxxd0MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMMMMMWWMMMKc',;;;;;;:xkl;;cloxdoxkOXMMXkddolododxxdxxxd0MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMMMWXKXXXN0:',;;::::ld:,,':kKOdxd:;cx0OxdoodxooddddxxxdKMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMMMWKOK00K0dc:;;:::::;;cc':OKxodlxkolodxkkO0Okdoddddxdd0MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMMMMNOOO0KKXX0xl::::clddxl,;::cONWKddxO0000OOxddddddddo0MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMMMMMWXKXKKXNNNX0kcclodooc;,lOxoxKK00K000OkxdddddddddooKMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMMMMMMMMWNOook000k::ll:;lodc:kK00XNNNXXKOxllooodoooododKMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMMMMMMMMMKd:,cdxkd::c:,;;cdd:cOXXXXK0kxdcc:coooooooooldXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
        MMMMMMMMMMMMMMWk;lkkOOkxlc:::,'.:xc.lkkkxooooc;::coooooooooldNMMMMMWNNMMMMMNXWMMMMXOKMMMMMMMMMMMMMMM
        MMMMMMMMMMMMMMWk;;lk00Okxxl;;'.,co:.,dkkkxdxxo:,;cooooollllcxNWNXK0OxdxOKNXdcd0WW0l':0WMMMMMMMMMMMMM
        MMMMMMMMMMMMMMWk;,:oddxdddl:,.'cccc:lox000kxddl,;lllllcccllcdko:;,'.,cccclo:;,:od:''.;OWWWWMMMMMMMMM
        MMMMMMMMMMMMMMWO:;:lddddddlc;';cc:lxOOOOkxxxxddl:cllcc::clc:,........';::::;;,,,','...:0klOWMMMMMMMM
        MMMMMMMMMMMMMMMO:;:cloodddlc:;:lc;,col:lxxxxxdddl:ccccccc:::..........'';;;,,,,,'''....,'.;0MMMMMMMM
        MMMMMMMMMMMMMMM0l:::cloodo:;c:;:;;,,,,';ldxdxddddc:::cclllc:'.......'''.',,',,''''.........cXMMMMMMM
        MMMMMMMMMMMMMMMKo:::cllooo,.::..',,',,,,:codddddddoc:coolc:;,'''''''''''''.'''..............xWMMMMMM
        MMMMMMMMMMMMMMMXdccccllooc,.'::....''',,;:cloooooddol::c;;,',,'',,,,,,,,,,''................;KMMMMMM
        MMMMMMMMMMMMMMMKoccccclll:;'',::...''.',;::clllooooooc;;c:,';::ccc:ccllccc:'.....''........ .kMMMMMM
        MMMMMMMMMMMMMMMKc;cccccccc:,';;,:. ....',;::cclllllool;,:::codoooolllllllcc,....,............lWMMMMM
        MMMMMMMMMMMMMMMKl:::ccccclc,',;::,.......';:::cccccccc:;::ldooollcccccccccc,.............    lX0XMMM
        MMMMMMMMMMMMMMM0lcc:cccccc:''colc,.........',;::::::::::::lllllcc::ccc:::::,...........      ',;0MMM
        MMMMMMMMMMMMMMMXd::::cc:c:;;clol:'............',;::::::::cccccc::::::::::::,.........     .....oWMMM
        MMMMMMMMMMMMMMMMNko:,,,;;;:clcll,...,,.''........',,,,;:ccccc:::::::;;;;;;;'..................,0MMMM
        MMMMMMMMMMMMMMMMMMWNKkxdc;::clc;'',oxc'',,,'''''....,::;::::::::;;;;;;;;;;;.......'''.........dWMMMM
        MMMMMMMMMMMMMMMMMMMMMMNx:;;;:::;;l0Xc..',,,,;;,,,'..,;;;:::;;;;,;,;;,,,,,,,...'','...........cXMMMMM
        MMMMMMMMMMMMMMMMMMMMMWk:;;;;:loxOKOo,..',,,,'',,'''..',,,,,,'''',,,,,,,,,,'.................cKMMMMMM
        MMMMMMMMMMMMMMMMMMMMWkc:;;:d0XX0d:'.....',;;;;,,'''....'''''''',,,,,,,,,,,'...........    'dNMMMMMMM
        MMMMMMMMMMMMMMMMMMMM0c,;;cONMXx;.......'',;;;;''''......''''''',,,,,,,,,,,.........       ,xXMMMMMMM
        """
        
        __pic = False

        __iig = False

        _outfit = None

        @staticmethod
        def findOutfitName():

            return Sayori._outfit.ref_name


        @staticmethod
        def setOutfit(outfit):

            Sayori._outfit = outfit
            store.persistent.fae_outfit_quit = Sayori._outfit.ref_name
        
        @staticmethod
        def isWearingOutfit(ref_name):

            return Sayori._outfit.ref_name == ref_name
        

        @staticmethod
        def isWearingClothes(ref_name):

            return Sayori._outfit.clothes.ref_name == ref_name
        

        @staticmethod
        def isWearingHairstyle(ref_name):

            return Sayori._outfit.hairstyle.ref_name == ref_name
        

        @staticmethod
        def isWearingAccessory(ref_name):

            return Sayori._outfit.accessory.ref_name == ref_name


        @staticmethod
        def isWearingEyewear(ref_name):
            
            return Sayori._outfit.eyewear.ref_name == ref_name
        

        @staticmethod
        def isWearingHeadgear(ref_name):

            return Sayori._outfit.headgear.ref_name == ref_name
        
        @staticmethod
        def setInChat(p_i_c):
            """
            Sets Sayori state as in action with player.
            Disables hotkeys
            FEED:
                p_i_c = boolean value set to True
            """

            if not isinstance(p_i_c, bool):
                raise TypeError("p_i_c must be boolean")
            
            Sayori.__pic = p_i_c
        
        @staticmethod
        def setInGame(i_i_g):
            """
            Same as setInChat, but with games instead

            FEED:
                i_i_g = boolean value set to True
            """

            if not isinstance(i_i_g, bool):
                raise TypeError("i_i_g must be boolean")
            
            Sayori.__iig = i_i_g
        
        @staticmethod
        def isInChat():
            """
            Checks whether Sayori is in a topic, or interaction
            Hotkeys disabled

            RESULT:
                If in action, True, else False
            """
            return Sayori.__pic

        @staticmethod
        def isInGame():
            """
            Same as isInChat, but for games

            RESULT:
                If in game: True, False if now
            """
            return Sayori.__iig

        @staticmethod
        def add_new_regret_awaiting(regret_type):

            if not isinstance(regret_type, int) and not isinstance(regret_type, fae_regrets.RegretTypes):
                raise TypeError("regret_type must be of types int of fae_regrets.RegretTypes")
            
            if not int(regret_type) in store.persistent._fae_player_awaiting_apologies:
                store.persistent._fae_player_awaiting_apologies.append(int(regret_type))
        
        @staticmethod
        def add_regret_quit(regret_type):

            if not isinstance(regret_type, int) and not isinstance(regret_type, fae_regrets.RegretTypes):
                raise TypeError("regret_type must be of types int or fae_regrets.RegretTypes")
            
            store.persistent._fae_player_apology_type_on_quit = int(regret_type)
        
        @staticmethod
        def deleteRegret(regret_type):

            if not isinstance(regret_type, int) and not isinstance(regret_type, fae_regrets.RegretTypes):
                raise TypeError("regret_type must be of types int or fae_regrets.RegretTypes")
            
            if int(regret_type) in store.persistent._fae_player_awaiting_apologies:
                store.persistent._fae_player_awaiting_apologies.remove(int(regret_type))
        
        

init -2:
    default persistent.fae_outfit_self_change_enabled = True
    default persistent.fae_user_outfits_enabled = False
    default persistent.fae_outfit_quit = "fae_uniform"
    default persistent.fae_outfit_list = {}
    default persistent.fae_acs_list = {}


init -1 python in fae_outfits:
    from Enum import Enum
    import json
    import os
    import random
    import re
    import store
    import store.fae_utilities as fae_utilities
    import store.fae_affection as fae_affection
    import time
    
    #TO DO: AFFECTION

    __USER_ACS_DIR = os.path.join(renpy.config.basedir, "game/mod_assets/sayori/sitting/acs/").replace("\\", "/")
    __USER_OUTFITS_DIR = os.path.join(renpy.config.basedir, "game/mod_assets/sayori/sitting/clothes/").replace("\\", "/")
    __ACS_BASE_DIR = os.path.join(renpy.config.basedir, "game/mod_assets/sayori/")

    __DISALLOWED_CHARACTERS_REGEX = "((\.)|(\[)|(\])|(\})|(\{)|(,)|(\!))"


    __ALL_ACS = {}
    __ALL_OUTFITS = {}

    _PREV_OUTFITS = None
    _LAST_OUTFIT = None

    _VISIT_NEW_UNLOCKS = list()

    _changes_made = False


    ACS_CATS = [
        "hairstyle",
        "eyewear",
        "accessory",
        "clothes",
        "headgear",
        "necklace"
    ]


    class FAEAcs():

        def __init__(
            self,
            ref_name,
            disp_name,
            unlocked,
            is_fae_acs
        ):

            self.ref_name = ref_name
            self.disp_name = disp_name
            self.unlocked = unlocked
            self.is_fae_acs = is_fae_acs
        
        @staticmethod
        def call_all():

            global __ALL_ACS
            for acs in __ALL_ACS.values():
                acs.__call()
        
        @staticmethod
        def store_all():

            global __ALL_ACS
            for acs in __ALL_ACS.values():
                acs.__store()
        

        @staticmethod
        def acs_filt(
            acs_list,
            unlocked=None,
            is_fae_acs=None,
            ref_name=None,
            not_ref_name=None,
            acs_cat=None
        ):
            """
            Filtered list of clothing/appearance from a list and search params

            FEED:
                acs_list = list of FAEAcs children to search
                unlocked = True/False state to search
                is_fae_acs = True/False state to search
                ref_name = list of ref_name the item must have
                not_ref_name = list of ref_name the item must NOT have
                acs_cat = type of item to search for
            RESULT:
                list of FAEAcs children that match the criteria
            """

            return [
                _acs
                for _acs in acs_list
                if _acs.__acs_filt(
                    unlocked,
                    is_fae_acs,
                    ref_name,
                    not_ref_name,
                    acs_cat
                )
            ]
        
        def make_dict(self):

            return {
                "unlocked": self.unlocked
            }


        def unlock(self):

            self.unlocked = True
            self.__store()
        
        def lock(self):

            self.unlocked = False
            self.__store()
        

        def __call(self):
            """
            Loads the persisted data from the file
            """

            if store.persistent.fae_acs_list[self.ref_name]:
                self.unlocked = store.persistent.fae_acs_list[self.ref_name]["unlocked"]

        
        def __store(self):
            """
            Saves the persistable data to the file
            """


            store.persistent.fae_acs_list[self.ref_name] = self.make_dict()

        def __acs_filt(
            self,
            unlocked=None,
            is_fae_acs=None,
            ref_name=None,
            not_ref_name=None,
            acs_cat=None
        ):
            """
            Gives True if the item meets the criteria, otherwise False

            FEED:
                SEE acs_filt
            
            RESULT:
                True if the item matches search, False otherwise
            """

            if unlocked is not None and self.unlocked != unlocked:
                return False
            
            elif is_fae_acs is not None and self.is_fae_acs != is_fae_acs:
                return False
            
            elif ref_name is not None and not self.ref_name in ref_name:
                return False
            
            elif not_ref_name is not None and self.ref_name in not_ref_name:
                return False
            
            elif acs_cat is not None and not isinstance(self, acs_cat):
                return False
            
            return True
        
    
    class FAEHairstyle(FAEAcs):

        pass
    
    class FAEEyewear(FAEAcs):

        pass
    
    class FAEAccessory(FAEAcs):

        pass
    
    class FAEClothes(FAEAcs):

        pass
    
    class FAEHeadgear(FAEAcs):

        pass

    class FAENecklace(FAEAcs):

        pass
    

    class FAEOutfit():


        def __init__(
            self,
            ref_name,
            disp_name,
            unlocked,
            is_fae_outfit,
            clothes,
            hairstyle,
            accessory=None,
            eyewear=None,
            headgear=None,
            necklace=None
        ):
            """
            ref_name = Unique identifier for this item for internal use
            disp_name = The name the player will see
            unlocked = Should this item be selectable in menus?
            is_fae_outfit = whether or not this is made by us.
            clothes = FAEClothes linked to this outfit
            hairstyle = FAEHairstyle linked to this outfit
            accessory (OPTIONAL) = FAEAccessory linked to this outfit
            eyewear (OPTIONAL) = FAEEyewear linked to this outfit
            headgear (OPTIONAL) = FAEHeadgear linked to this outfit.
            """

            if clothes is None:
                raise TypeError("Clothes cannot be None")
                return
            
            if hairstyle is None:
                raise TypeError("Hairstyle cannot be None")
                return
            
            self.ref_name = ref_name
            self.disp_name = disp_name
            self.unlocked = unlocked
            self.is_fae_outfit = is_fae_outfit
            self.clothes = clothes
            self.hairstyle = hairstyle
            self.accessory = accessory
            self.eyewear = eyewear
            self.headgear = headgear
            self.necklace = necklace
        
        @staticmethod
        def call_all():
            """
            Loads persistent data for every outfit
            """

            global __ALL_OUTFITS
            for outfit in __ALL_OUTFITS.values():
                outfit.__call()
        
        @staticmethod
        def store_all():
            """
            Saves persistable data
            """

            global __ALL_OUTFITS
            for outfit in __ALL_OUTFITS.values():
                outfit.__store()

        
        @staticmethod
        def outfit_filt(
            outfit_list,
            unlocked=None,
            is_fae_outfit=None,
            not_ref_name=None,
            has_accessory=None,
            has_eyewear=None,
            has_headgear=None,
            has_necklace=None
        ):
            """
            Gives a filtered list of outfits based on search params

            FEED:
                outfit_list = FAEOutfit to search
                unlocked = True/False to search
                is_fae_outfit = True/False to search
                not_ref_name = ref_name(s) the outfit can't have
                has_accessory = True/False to search
                has_eyewear = True/False to search
                has_headgear = True/False to search
            RESULT:
                list of FAEOutfit items that satisfy the given params
            """

            return [
                _outfit
                for _outfit in outfit_list
                if _outfit.__outfit_filt(
                    unlocked,
                    is_fae_outfit,
                    not_ref_name,
                    has_accessory,
                    has_eyewear,
                    has_headgear,
                    has_necklace
                )
            ]
        
        def as_dict(self):

            """
            Creates a dictionary of the outfit for saving to the persistent memory
            """

            return {
                "unlocked": self.unlocked
            }


        def unlock(self):

            self.unlocked = True
            self.__store()


            if not self.clothes.unlocked:
                self.clothes.unlock()

            
            if not self.hairstyle.unlocked:
                self.hairstyle.unlock()

            if self.accessory and not self.accessory.unlocked:
                self.accessory.unlock()

            if self.eyewear and not self.eyewear.unlocked:
                self.eyewear.unlock()

            if self.headgear and not self.headgear.unlocked:
                self.headgear.unlock()
            
            if self.necklace and not self.necklace.unlocked:
                self.necklace.unlock()
        
        def lock(self):

            self.unlocked = False
            self.__store()


        def to_json(self):

            dict_outfit = {
                "ref_name": self.ref_name,
                "disp_name": self.disp_name,
                "unlocked": True,
                "clothes": self.clothes.ref_name,
                "hairstyle": self.hairstyle.ref_name
            }
        

            if self.headgear and isinstance(self.headgear, FAEHeadgear):

                dict_outfit["headgear"] = self.headgear.ref_name
            
            if self.eyewear and isinstance(self.eyewear, FAEEyewear):
                dict_outfit["eyewear"] = self.eyewear.ref_name
            
            if self.accessory and isinstance(self.accessory, FAEAccessory):
                dict_outfit["accessory"] = self.accessory.ref_name
            
            if self.necklace and isinstance(self.necklace, FAENecklace):
                dict_outfit["necklace"] = self.necklace.ref_name
            
            return json.dumps(dict_outfit)

        
        def __call(self):
            """
            Loads data for outfit from persistent memory, provided it exists
            """

            if store.persistent.fae_outfit_list[self.ref_name]:
                self.unlocked = store.persistent.fae_outfit_list[self.ref_name]["unlocked"]
            
        def __store(self):
            """
            Saves the data to the persistent memory
            """

            store.persistent.fae_outfit_list[self.ref_name] = self.as_dict()
        
        def __rem_save(self):
            """
            Removes data for outfit from persistent memory, provided it exists
            """

            if store.persistent.fae_outfit_list[self.ref_name]:
                del store.persistent.fae_outfit_list[self.ref_name]
        

        def __outfit_filt(
            self,
            unlocked=None,
            is_fae_outfit=None,
            not_ref_name=None,
            has_accessory=None,
            has_eyewear=None,
            has_headgear=None,
            has_necklace=None
        ):
            """
            True if outfit matches search params, False if not
            
            FEED:
                See outfit_filt
            RESULT:
                True if outfit matches search params, False if not
            """

            if unlocked is not None and self.unlocked != unlocked:

                return False
            
            elif is_fae_outfit is not None and self.is_fae_outfit != is_fae_outfit:
                return False

            elif not_ref_name is not None and self.ref_name in not_ref_name:
                return False

            elif has_accessory is not None and bool(self.has_accessory) != has_accessory:
                return False

            elif has_eyewear is not None and bool(self.has_eyewear) != has_eyewear:
                return False

            elif has_headgear is not None and bool(self.has_headgear) != has_headgear:
                return False
            
            elif has_necklace is not None and bool(self.necklace) != has_necklace:
                return False

            return True


    def __reg_outfit(outfit, player_created=False):
        """
        Adds new outfit to complete list
        If it doesn't exist already in persistent memory, it's saved

        FEED:
            outfit = the FAEOutfit to save
        """


        if outfit.ref_name in __ALL_OUTFITS:

            fae_utilities.log("Cannot register outfit name: {0}, as an outfit already exists with that name.".format(outfit.ref_name))


        else:

            if not outfit.accessory:
                outfit.accessory = get_acs("fae_none")

            if not outfit.eyewear:
                outfit.eyewear = get_acs("fae_none")

            if not outfit.headgear:
                outfit.headgear = get_acs("fae_none")
            
            if not outfit.necklace:
                outfit.necklace = get_acs("fae_none")

            __ALL_OUTFITS[outfit.ref_name] = outfit
            if outfit.ref_name not in store.persistent.fae_outfit_list:
                outfit.__store()

                if not "fae_" in outfit.ref_name and not player_created:
                    _VISIT_NEW_UNLOCKS.append(outfit)


    def __reg_acs(acs):

        if acs.ref_name in __ALL_ACS:
            fae_utilities.log("Cannot register acs name: {0}, as already exists.".format(acs.ref_name))
        
        else:
            __ALL_ACS[acs.ref_name] = acs
            if acs.ref_name not in store.persistent.fae_acs_list:
                acs.__store()

                if not "fae_" in acs.ref_name:
                    _VISIT_NEW_UNLOCKS.append(acs)

            else:
                acs.__call()
    
    def __rem_outfit(outfit):

        """
        Remove an outfit from the complete database
        If it's present in the persistent file, it's removed
        """

        outfit.__rem_save()
        del __ALL_OUTFITS[outfit.ref_name]
    

    def _check_acs_sprites(acs):

        ACS_CATS_PATH_DEFS = {
            FAEHairstyle: "hair",
            FAEEyewear: "eyewear",
            FAEAccessory: "accessory",
            FAEClothes: "clothes",
            FAEHeadgear: "headgear",
            FAENecklace: "necklace"
        }

        for pose in store.fae_sprites.FAEPose:
            
            res_path = os.path.join(
                __ACS_BASE_DIR,
                pose.name,
                ACS_CATS_PATH_DEFS[type(acs)],
                acs.ref_name
            )


            if isinstance(acs, FAEHairstyle):

                if (
                    not fae_utilities.doesExist(os.path.join(res_path, "a.png"))
                ):

                    fae_utilities.log("Missing sprite(s) for {0}: check {1}.".format(acs.ref_name, res_path))
                    return False
            
            elif not fae_utilities.doesExist(os.path.join(res_path, "{0}.png".fomat(pose.name))):
                fae_utilities.log("Missing sprite(s) for {0}: check{1}".format(wearable.ref_name, res_path))
                return False
        
        return True
    
    def _get_acs_from_json(json):
        """
        Tries to load acs from JSON file and add it

        FEED:
            json = JSON defining the item
        """

        if(
            "ref_name" not in json
            or "disp_name" not in json
            or "unlocked" not in json
            or "cat" not in json
        ):
            fae_utilities.log("Cannot add as attributes do not exist.")
            return False
        
        elif(
            not isinstance(json["ref_name"], basestring)
            or not isinstance(json["disp_name"], basestring)
            or not isinstance(json["unlocked"], bool)
            or not isinstance(json["category"], basestring)
            or not json["category"] in ACS_CATS
        ):
            fae_utilities.log("Cannot load {0} as attributes are incorrect type.".format(json["ref_name"]))
            return False
        
        elif re.search("^fae_.", json["ref_name"].lower()):
            fae_utilities.log("Cannot load acs {0} as the ref name contains a reserved namespace.".format(json["ref_name"]))
            return False
        
        elif re.search(__DISALLOWED_CHARACTERS_REGEX, json["ref_name"]):
            fae_utilities.log("Cannot load {0} as the name contains forbidden characters.".format(json["ref_name"]))
            return False

        else:

            kwargs = {
                "ref_name": json["ref_name"],
                "disp_name": json["disp_name"],
                "unlocked": json("unlocked"),
                "is_fae_acs": False
            }


            if json["cat"] == "hairstyle":
                acs = FAEHairstyle(**kwargs)
            
            elif json["cat"] == "eyewear":
                acs = FAEEyewear(**kwargs)
            
            elif json["cat"] == "accessory":
                acs = FAEAccessory(**kwargs)
            
            elif json["cat"] == "clothes":
                acs = FAEClothes(**kwargs)
            
            elif json["cat"] == "headgear":
                acs = FAEHeadgear(**kwargs)
            
            elif json["cat"] == "necklace":
                wearable = FAENecklace(**kwargs)
            
            if not _check_acs_sprites(acs):
                fae_utilities.log("Cannot load acs {0} as sprites are missing".format(acs.ref_name))
                return False
            
            __reg_acs(acs)
            return True
    

    def _get_outfit_from_json(json):
        """
        Tries to get outfit from JSON file and add it

        FEED:
            json = JSON file defining outfit
        RESULT:
            If success: True, else False
        """


        if (
            "ref_name" not in json
            or "disp_name" not in json
            or "unlocked" not in json
            or "clothes" not in json
            or "hairstyle" not in json
        ):

            fae_utilities.log("Cannot load outfit as missing attributes")
            return False
        
        elif (
            not isinstance(json["ref_name"], basestring)
            or not isinstance(json["disp_name"], basestring)
            or not isinstance(json["unlocked"], bool)
            or not isinstance(json["clothes"], basestring)
            or not isinstance(json["hairstyle"], basestring)
            or "eyewear" in json and not isinstance(json["eyewear"], basestring)
            or "headgear" in json and not isinstance(json["headgear"], basestring)
            or "necklace" in json and not isinstance(json["necklace"], basestring)
        ):
            fae_utilities.log("Cannot load outfit as data is incorrect.")
            return False
        
        elif re.search("^fae_.", json["ref_name"].lower()):
            fae_utilities.log("Cannot load outfit {0} as the ref name contains a reserved namespace.".format(json["ref_name"]))
            return False
        
        elif re.search(__DISALLOWED_CHARACTERS_REGEX, json["ref_name"]):
            fae_utilities.log("Cannot load outfit {0} as the name has forbidden characters.".format(json["ref_name"]))
            return False

        if not json["clothes"] in __ALL_ACS:
            fae_utilities.log("Cannot load outfit {0} as it does not exist.".format(json["ref_name"]))
            return False
        
        elif not json["hairstyle"] in __ALL_ACS:
            fae_utilities.log("Cannot load outfit {0} as specified hairstyle doesn't exist".format(json["ref_name"]))
            return False
        
        elif "accessory" in json and not json["accessory"] in __ALL_ACS:
            fae_utilities.log("Cannot load outfit {0} as accessory doesn't exist.".format(json["ref_name"]))
            return False
        
        elif "eyewear" in json and not json["eyewear"] in __ALL_ACS:
            fae_utilities.log("Cannot load outfit {0} as eyewear doesn't exist.".format(json["ref_name"]))
            return False
        
        elif "headgear" in json and not json["headgear"] in __ALL_ACS:
            fae_utilities.log("Cannot load outfit {0} as headgear doesn't exist.".format(json["ref_name"]))
            return False

        elif "necklace" in json and not json["necklace"] in __ALL_ACS:
            fae_utilities.log("Cannot load outfit {0} as specified necklace does not exist.".format(json["reference_name"]))
            return False
        
        else:
            outfit = FAEOutfit(
                ref_name=json["ref_name"],
                disp_name=json["disp_name"],
                unlocked=json["unlocked"],
                is_fae_outfit=False,
                clothes=__ALL_ACS[json["clothes"]],
                hairstyle=__ALL_ACS[json["hairstyle"]],
                accessory=__ALL_ACS[json["accessory"]] if "accessory" in json else None,
                eyewear=__ALL_ACS[json["eyewear"]] if "eyewear" in json else None,
                headgear=__ALL_ACS[json["headgear"]] if "headgear" in json else None,
                necklace=__ALL_ACS[json["necklace"]] if "necklace" in json else None
            )

            if not isinstance(outfit.clothes, FAEClothes):
                fae_utilities.log("Cannot load outfit {0} because specified clothes are not valid clothing.".format(outfit.ref_name))
                return False
            
            elif not isinstance(outfit.hairstyle, FAEHairstyle):
                fae_utilities.log("Cannot load outfit {0} because hairstyle is not valid.".format(outfit.ref_name))
                return False
            
            elif outfit.accessory and not isinstance(outfit.accessory, FAEAccessory):
                fae_utilities.log("Cannot load outfit {0} because accessory is not valid.".format(outfit.ref_name))
                return False
            
            elif outfit.eyewear and not isinstance(outfit.eyewear, FAEEyewear):
                fae_utilities.log("Cannot load outfit {0} because eyewear is not valid.".format(outfit.ref_name))
                return False
            
            elif outfit.headgear and not isinstance(outfit.headgear, FAEHeadgear):
                fae_utilities.log("Cannot load outfit {0} because headgear is not valid.".format(outfit.ref_name))
                return False

            elif outfit.necklace and not isinstance(outfit.necklace, FAENecklace):
                fae_utilities.log("Cannot load outfit {0} because necklace is not valid.".format(outfit.ref_name))
                return False
            
            if outfit.unlocked:
                if (
                    not outfit.clothes.unlocked
                    or not outfit.hairstyle.unlocked
                    or outfit.accessory and not outfit.accessory.unlocked
                    or outfit.eyewear and not outfit.eyewear.unlocked
                    or outfit.headgear and not outfit.headgear.unlocked
                    or outfit.necklace and not outift.necklace.unlocked
                ):
                    fae_utilities.log("Outfit {0} contains locked elements; locking outfit.".format(outfit.ref_name))
                    outfit.unlocked = False
            
            __reg_outfit(outfit)
            return True
    
    def _wipe_outfit_list():
        
        __ALL_OUTFITS = {}
    
    def _wipe_acs_list():

        __ALL_ACS = {}
    
    def call_user_outfit():

        if fae_utilities.makedirifnot(__USER_OUTFITS_DIR):

            fae_utilities.log("Unable to load custom outfit as dir didn't exist, and was created.")
            return
        
        outfit_files = fae_utilities.getDirFile(__USER_OUTFITS_DIR, ["json"])
        success_count = 0

        for name, path in outfit_files:
            try:
                with open(path) as outfit_data:
                    if _get_outfit_from_json(json.loads(outfit_data.read())):
                        success_count += 1
            
            except OSError:
                fae_utilities.log("Unable to read file {0}; file could not be found.".format(file))
            
            except TypeError:
                fae_utilities.log("Unable to read file {0}; corrupt, or invalid JSON.".format(file))

            except ValueError:
                fae_utilities.log("Unable to read file {0}; corrupt file or invalid JSON.".format(file_name))

            
            except:
                raise
        
        if not success_count == len(outfit_files):
            renpy.notify("One or more outfits couldn't load; check log for more information.")
    

    def get_user_acs():

        if fae_utilities.makedirifnot(__USER_ACS_DIR):
            fae_utilities.log("Unable to load custom acs as directory does not exist, and was created.")
            return
        
        acs_files = fae_utilities.getDirFile(__USER_ACS_DIR, ["json"])
        success_count = 0

        for name, path in acs_files:
            try:
                with open(path) as acs_data:
                    if _get_acs_from_json(json.loads(acs_data.read())):
                        success_count += 1
            
            except OSError:
                fae_utilities.log("Unable to read file {0}; file could not be found.".format(name))
            
            except TypeError:
                fae_utilities.log("Unable to read file {0}; corrupt or bad JSON.".format(name))

            except ValueError:
                fae_utilities.log("Unable to read file {0}; corrupt file or invalid JSON.".format(file_name))

            
            except:
                raise

        if not success_count == len(acs_files):
            renpy.notify("One or more acs failed to load; check log.")
    

    def deload_user_outfit():

        __ALL_OUTFITS = FAEOutfit.outfit_filt(
            outfit_list=find_all_outfits(),
            is_fae_outfit=True)
    
        return
    
    def deload_user_acs():

        __ALL_ACS = FAEAcs.acs_filt(
            acs_list=find_all_acs(),
            is_fae_acs=True)
        
        return



    def outfit_exists(outfit_name):

        return outfit_name in __ALL_OUTFITS
    

    def acs_exists(acs_name):

        return acs_name in __ALL_ACS
    
    def get_outfit(outfit_name):

        if outfit_exists(outfit_name):
            return __ALL_OUTFITS[outfit_name]
        
        return None
    
    def get_acs(acs_name):

        if acs_exists(acs_name):
            return __ALL_ACS[acs_name]
        
        return None
    

    def find_all_outfits():

        return __ALL_OUTFITS.values()
    
    def find_all_acs():

        return __ALL_ACS.values()
    

    def store_user_outfit(outfit):

        new_user_outfit = FAEOutfit(
            ref_name="{0}_{1}_{2}".format(
                store.persistent.playername,
                outfit.disp_name.replace(" ", "_"),
                int(time.time())
            ).lower(),
            disp_name=outfit.disp_name,
            unlocked=True,
            is_fae_outfit=False,
            clothes=outfit.clothes,
            hairstyle=outfit.hairstyle,
            accessory=outfit.accessory,
            eyewear=outfit.eyewear,
            headgear=outfit.headgear,
            necklace=outfit.necklace
        )

        if fae_utilities.makedirifnot(__USER_OUTFITS_DIR):
            fae_utilities.log("Custom outfits dir was not found and was created.")
        
        try:

            with open(os.path.join(__USER_OUTFITS_DIR, "{0}.json".fomat(outfit.ref_name)), "w") as file:
                file.write(outfit.to_json())
            
            __reg_outfit(outfit, player_created=True)
            store.Sayori.setOutfit(outfit)
            renpy.notify("Outfit saved!")
            return True
        

        except Exception as exception:
            renpy.notify("Save failed; see log for more informaton.")
            fae_utilities.log("Failed to save outfit {0}, as writing was not possible.".format(outfit.disp_name))
            return False


    def remove_user_outfit(outfit):

        if fae_utilities.makedirifnot(__USER_OUTFITS_DIR):

            fae_utilities.log("Custom outfits dir was not found and created.")
        
        elif not fae_utilities.removeFileDir(
            path=os.path.join(__USER_OUTFITS_DIR, "{0}.json".format(outfit.ref_name))
        ):
            renpy.notify("Delete failed; check log for more information.")
            fae_utilities.log("Failed to remove outfit {0}, as deleting was impossible.".format(outfit.disp_name))
            return False

        else:

            __rem_outfit(outfit)
            renpy.notify("Outfit deleted!")
            return True
    
    def find_timenow_outfit():

        if store.Affection.isAffectionate(higher=True):
            if store.fae_is_weekday():
                return _OUTFIT_SCHEDULE_WEEKDAY_HIGH_AFFECTION.get(store.fae_get_current_time_block())
            
            else:
                return _OUTFIT_SCHEDULE_WEEKEND_HIGH_AFFECTION.get(store.fae_get_current_time_block())
        
        else:
            if store.fae_is_weekday():
                return _OUTFIT_SCHEDULE_WEEKDAY_LOW_AFFECTION.get(store.fae_get_current_time_block())
            
            else:

                return _OUTFIT_SCHEDULE_WEEKEND_LOW_AFFECTION.get(store.fae_get_current_time_block())

    
    __reg_acs(FAEHairstyle(
        ref_name="fae_bow",
        disp_name="Bow",
        unlocked=True,
        is_fae_acs=True
    ))

    __reg_acs(FAEClothes(
        ref_name="fae_uniform",
        disp_name="School Uniform",
        unlocked=True,
        is_fae_acs=True
    ))

    __reg_acs(FAEClothes(
        ref_name="base",
        disp_name="Base",
        unlocked=True,
        is_fae_acs=True
    ))

    __reg_acs(FAEClothes(
        ref_name="casual",
        disp_name="Tank Top",
        unlocked=True,
        is_fae_acs=True
    ))

    __reg_acs(FAENecklace(
        ref_name="fae_scarf",
        disp_name="Scarf",
        unlocked=False,
        is_fae_acs=True
    ))

    __reg_acs(FAEAccessory(
        ref_name="fae_headphones",
        disp_name="Headphones",
        unlocked=True,
        is_fae_acs=True
    ))

    __reg_outfit(FAEOutfit(
        ref_name="base",
        disp_name="Base",
        unlocked=True,
        is_fae_outfit=True,
        clothes=get_acs("base"),
        hairstyle=get_acs("fae_bow")
    ))

    __reg_outfit(FAEOutfit(
        ref_name="fae_uniform",
        disp_name="School Uniform",
        unlocked=True,
        is_fae_outfit=True,
        clothes=get_acs("fae_uniform"),
        hairstyle=get_acs("fae_bow")
    ))

    __reg_outfit(FAEOutfit(
        ref_name="casaul",
        disp_name="Casual/Tank Top",
        unlocked=True,
        is_fae_outfit=True,
        clothes=get_acs("casual"),
        hairstyle=get_acs("fae_bow")
    ))

    __reg_outfit(FAEOutfit(
        ref_name="fae_christmas",
        disp_name="Christmas Outfit",
        unlocked=False,
        is_fae_outfit=True,
        clothes=get_acs("fae_uniform"),
        hairstyle=get_acs("fae_bow"),
        necklace=get_acs("fae_scarf")
    ))
            
    
    _OUTFIT_SCHEDULE_WEEKDAY_HIGH_AFFECTION = {

        store.FAETimeBlocks.early_morning: get_outfit("fae_uniform"),
        store.FAETimeBlocks.mid_morning: get_outfit("fae_uniform"),
        store.FAETimeBlocks.late_morning: get_outfit("fae_uniform"),
        store.FAETimeBlocks.afternoon: get_outfit("fae_uniform"),
        store.FAETimeBlocks.evening: get_outfit("fae_uniform"),
        store.FAETimeBlocks.night: get_outfit("fae_uniform")
    }


    _OUTFIT_SCHEDULE_WEEKEND_HIGH_AFFECTION = {

        store.FAETimeBlocks.early_morning: get_outfit("fae_uniform"),
        store.FAETimeBlocks.mid_morning: get_outfit("fae_uniform"),
        store.FAETimeBlocks.late_morning: get_outfit("fae_uniform"),
        store.FAETimeBlocks.afternoon: get_outfit("fae_uniform"),
        store.FAETimeBlocks.evening: get_outfit("fae_uniform"),
        store.FAETimeBlocks.night: get_outfit("fae_uniform")

    }

    _OUTFIT_SCHEDULE_WEEKDAY_LOW_AFFECTION = {

        store.FAETimeBlocks.early_morning: get_outfit("fae_uniform"),
        store.FAETimeBlocks.mid_morning: get_outfit("fae_uniform"),
        store.FAETimeBlocks.late_morning: get_outfit("fae_uniform"),
        store.FAETimeBlocks.afternoon: get_outfit("fae_uniform"),
        store.FAETimeBlocks.evening: get_outfit("fae_uniform"),
        store.FAETimeBlocks.night: get_outfit("fae_uniform")
    }


    _OUTFIT_SCHEDULE_WEEKEND_LOW_AFFECTION = {

        store.FAETimeBlocks.early_morning: get_outfit("fae_uniform"),
        store.FAETimeBlocks.mid_morning: get_outfit("fae_uniform"),
        store.FAETimeBlocks.late_morning: get_outfit("fae_uniform"),
        store.FAETimeBlocks.afternoon: get_outfit("fae_uniform"),
        store.FAETimeBlocks.evening: get_outfit("fae_uniform"),
        store.FAETimeBlocks.night: get_outfit("fae_uniform")

    }




label outfit_wear_outfit:

    if not fae_outfits.find_all_outfits():

        s "I don't have any."
        jump ch30_loop

    
    s "Another one?"
    show sayori idle at fae_left

    python:

        options = []
        available_outfits = fae_outfits.FAEOutfit.outfit_filt(
            outfit_list = fae_outfits.find_all_outfits(),
            unlocked=True)
        
        available_outfits.sort(key = lambda option: option.disp_name)

        for outfit in available_outfits:
            options.append((fae_utilities.RenpySubSub(outift.disp_name), outfit))
        
        options.insert(0, ("Yu pick!", "random"))
    
    call screen neat_menu_scroll(options, ("Nevermind.", None))
    show sayori at fae_center

    if isinstance(_return, fae_outfits.FAEOutfit):
        $ outfit_name = _return.disp_name.lower()
        s "Sure"

        $ Sayori.setOutfit(_return)
        with Fade(out_time=0.1, hold_time=1, in_time=0.5, color="#181212")

    elif _return = "random":
        s "Okay"

        $ Sayori.setOutfit(
            random.choice(
                fae_outfits.FAEOutfit.outfit_filt(
                    outfit_list=fae_outfits.find_all_outfits(),
                    unlocked=True,
                    not_ref_name=Sayori.findOutfitName())
            )
        )
        
        with Fade(out_time=0.1, hold_time=1, in_time=0.5, color="#181212")

        s "Done"
    
    else:
        s "Okay"
    
    return
    
